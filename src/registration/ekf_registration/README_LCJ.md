# ekf_registration:
# edited by lichunjing 2022.11.30:


### 1. 为了和fast-lio时间戳戳判断一致，暂时将 ekf_registration.cc中PrepareMeasurements()函数的如下行大约380行进行替换，测试完成后恢复成正常的
```
if(imu_time > measurements_.lidar_end_time)   //正常代码
if(common::ToUniversalSeconds(imu_time) > common::ToUniversalSeconds(measurements_.lidar_end_time))  //为了和fast-lio时间戳戳判断一致，暂时替换的代码
```

### 2.最后一帧数据
## 多倍速下可能导致数据丢帧，导致计算结果不一致，一倍速下，和fast_lio2计算结果一致
-------------------使用 common::Time时间戳进行 上面第一点的比较
----从4984开始：
------------------------------------------------------------------------------------------------------------------
---------allframe_id:2170   lidar_points:6104
------update lidar_position: -117.2306288169983190528001  -65.42242360972620929260302 -0.4873737209498899547455153
--------------delta_time:32.34455700000000177851689

----从第一帧开始：
------------------------------------------------------------------------------------------------------------------
---------allframe_id:2167   lidar_points:6104
------update lidar_position: -117.3007742238488617658732  -65.39201490070779243524157 -0.4422582978555094079808896
--------------delta_time:32.56373399999999662668415



<!-- 161秒，1593，6352 -->

-------------------使用 common::ToUniversalSeconds时间戳进行 上面第一点的比较
----从4984开始：(3倍速播放)
------------------------------------------------------------------------------------------------------------------
---------allframe_id:2170   lidar_points:6104
----------imu_buffer.size:42  lidar_end_time:63769777175.73175048828125
------predict lidar_position_: -117.205881276938598034576  -65.4687735966221993066938 -0.511800511246949141330731
------update lidar_position:-117.2076998818585877870646 -65.47412199981982894314569  -0.50963492971323665070571



## 多倍速下可能导致数据丢帧，导致计算结果不一致，一倍速下，和fast_lio2计算结果一致
----从4984开始：(1倍速播放)
------------------------------------------------------------------------------------------------------------------
---------allframe_id:2170   lidar_points:6104
------predict lidar_position_: -117.2031236450053057751575  -65.46004147315218801850278 -0.4991410290319550635551593
------------move_distance:150
------------features_from_map_num:234254
------update lidar_position:-117.2047326313079622650548 -65.46323125805267295618251 -0.496930796864558432801573